import java.util.ArrayList;
import java.util.concurrent.Semaphore;

public class CheckOut {
    //Class about the checkout , the objective of this class is to manage customers and their cart

    private ArrayList<Costumer> customers;

    private Semaphore semaphore;

    public CheckOut() {
        customers = new ArrayList<>();
        semaphore = new Semaphore(1);
        addCustomer(new Costumer("Ivan"));
        addCustomer(new Costumer("Victor"));
        addCustomer(new Costumer("Niko"));
        addCustomer(new Costumer("Rodri"));
        addCustomer(new Costumer("Alberto"));
    }


    public void addCustomer(Costumer customer) {
        customers.add(customer);
    }

    public void startProcessing() {

        for (int i = 0; i < 2; i++) {
            Thread customerThread = new Thread(() -> {

                processNextCustomer();
            });
            customerThread.start();
        }
    }

    private void processNextCustomer() {
        try {

            semaphore.acquire();

            if (!customers.isEmpty()) {
            }
            Costumer customer = customers.remove(0);
            processclients(customer);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
        semaphore.release();


    }

    public void processclients() throws InterruptedException {
        for (Costumer customer : customers) { // Recorrer la lista de clientes
            Thread.sleep(1000);  // Simular un tiempo de espera para procesar al cliente
            long startTime = System.currentTimeMillis();
            System.out.println("Processing customer: " + customer.getName());

            for (String product : customer.getCart()) {  // Recorrer los productos del cliente
                Thread.sleep(1000);  // Simular un tiempo de espera para procesar cada producto
                System.out.println("Processing product: " + product);
            }

            long endTime = System.currentTimeMillis();
            long duration = endTime - startTime;
            System.out.println("Time to process the client : " + duration + " ms");
        }

    }
}

